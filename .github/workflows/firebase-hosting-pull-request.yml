# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR
on: 
  pull_request:
    branches: 
      - '**'
      - '!renovate/**'
jobs:
  build_and_preview:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0
      - uses: pnpm/action-setup@a7487c7e89a18df4991f7f222e4898a00d66ddda # v4.1.0
      - uses: actions/setup-node@a0853c24544627f65ddf259abe73b1d18a591444 # v5.0.0
        with:
          node-version-file: '.node-version'
          cache: 'pnpm'

      - run: pnpm i
      - run: HASH="$GITHUB_SHA" pnpm run web:build
      - uses: FirebaseExtended/action-hosting-deploy@e2eda2e106cfa35cdbcf4ac9ddaf6c4756df2c8c # v0.10.0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_CICUMIKUJI }}'
          projectId: cicumikuji
        env:
          FIREBASE_CLI_PREVIEWS: hostingchannels
      - id: auth
        name: Authenticate to Google Cloud
        uses: google-github-actions/auth@c200f3691d83b41bf9bbd8638997a462592937ed # v2
        with:
          credentials_json: '${{ secrets.FIREBASE_FUNCTION_SERVICE_ACCOUNT }}'
      - name: Install firebase tools
        run: npm install -g firebase-tools
      - name: Deploy Functions
        run: firebase deploy --only functions --dry-run
